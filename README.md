# Breast Cancer Classification - Baseline

このリポジトリは、乳がん画像を2クラス（`0` / `1`）に分類するためのベースライン実装を含みます。主に PyTorch を用いたシンプルな畳み込みニューラルネットワーク（CNN）で学習・予測を行います。

**注意**: リポジトリ内のサンプルコード（`baseline.py`, `baseline.ipynb`）は動作の参考実装です。実行前にデータパスやハイパーパラメータの確認・調整を推奨します。

**プロジェクト構成（想定）**:
- `train/` : 訓練用画像フォルダ（中に `0/`, `1/`）
- `valid/` : 検証用画像フォルダ（中に `0/`, `1/`）
- `test/`  : テスト用画像フォルダ（画像ファイルのみ）
- `source-code/baseline.py` : トレーニング/評価/予測を行うスクリプト
- `source-code/baseline.ipynb` : ノートブック（手順の説明・実行例）

データは次のようなディレクトリ構造で配置されることを想定しています（例）:

```
dataset/
  train/
    0/
    1/
  valid/
    0/
    1/
  test/
    img_0001.png
    img_0002.png
```

## 実行前の準備

- 必要ライブラリ（例）:

```
pip install torch torchvision pillow tqdm scikit-learn pandas matplotlib
```

- `baseline.py` 内の以下の変数を実行環境に合わせて更新してください:
  - `train_dir` : 訓練データのルートディレクトリ
  - `val_dir`   : 検証データのルートディレクトリ
  - `test_dir`  : テストデータのルートディレクトリ

（既定では `"/workspace/"` に設定されています。適切なパスに変更してください）

## 実行方法（例）

1. データ配置と `baseline.py` 内のパスを確認
2. 以下コマンドでスクリプトを実行

```
python source-code/baseline.py
```

実行後、学習済み重みと予測結果が以下に保存されます（`baseline.py` の設定に依存）:

- 重み: `./Weight/breast_cancer_model.pth`
- 予測サブミット: `./Prediction/sample_submit.csv`

## baseline.py の実装サマリ

- データ読み込み: `BreastCancerDataset`（クラスごとのフォルダを巡回して画像パスとラベルを収集）
- 前処理: リサイズ、正規化、訓練時はランダムフリップ等のデータ拡張が設定されています（ノートブックとスクリプトでサイズや augmentation が異なる点があります。注意してください）
- モデル: `CNNModel`（複数の Conv2d + Pool 層、全結合層を持つ簡易CNN）
- 損失関数: `BCELoss`（出力は Sigmoid を通して二値確率を出力）
- 最適化: `Adam`（学習率 `0.001`）
- 学習ループ: エポックごとに訓練と検証を実行、損失・精度をログ
- 保存: 学習後にモデル重みを保存、検証データで評価（Accuracy, AUC, Sensitivity, Specificity を計算）

## 実装上の注意・改善点（目視で確認したもの）

- `CNNModel` の最終全結合層に関して入力・出力次元の不一致の懸念があります。具体的には `fc3` の出力ユニット数と `out = nn.Linear(12, 1)` の入力が合っていないように見えます。このため実行時にサイズ不一致エラーが発生する可能性があります。`fc3` の出力次元に合わせて `out` を修正してください。
- 損失に `BCELoss` を使う場合、出力層が Sigmoid を返す（現在の実装）か、`BCEWithLogitsLoss` を使って生出力（logit）で学習するかを統一した方が数値的に安定します。
- データパスやバッチサイズ、入力画像サイズ（224 / 300など）がノートブックとスクリプト間で一致していない箇所があるため、実行前に統一してください。
- 学習中のランダムシード設定や `num_workers` の調整は再現性や読み込み速度に影響します。

## 追加の提案

- モデルを安定化するために、既存の事前学習済みバックボーン（例: EfficientNet, ResNet）を利用することを推奨します。`baseline.ipynb` 内で `efficientnet_b3` がインポートされている箇所があるため、そこを活用すると精度向上が期待できます。
- 推論用のスクリプト分割（例: `train.py`, `predict.py`, `utils.py`）にして運用しやすくする。
- ハイパーパラメータの設定を外部 YAML / JSON に切り出すと再現性が向上します。

## ライセンス

用途に応じて適切なライセンスを追加してください（現状はライセンス未指定）。

---

必要なら、この README を改良して `requirements.txt` の追加、`run` スクリプトの作成、または `baseline.py` の修正（上記の不整合対応）を行います。どうしますか？
